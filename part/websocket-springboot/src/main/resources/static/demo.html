<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>示例文件</title>
</head>
<body>
<!--由于没有前端代码，所以只能照着示范敲敲-->
<script>
    // 获取当前登录的用户
    var username
    var toName

    function showChat(name) {
        toName = name
        // 显示聊天对话框
        // ...
        // 显示正在和谁对话
        // ...
        // 清空聊天区
        $("#msgs").html('')
        // 恢复聊天数据
        var chatData = sessionStorage.getItem(toName)
        if (!chatData) {
            // 将聊天记录渲染到聊天区
            $("#msg").html(chatData)
        }
    }

    // 创建websocket对象
    var ws = new WebSocket("ws://localhost:8081/chat")

    // 给ws绑定事件
    ws.onopen = function () {
        // 在建立连接之后要做什么事情
        // 显示当前用户在线状态
        // ...
    }
    // 接收到服务端推送的消息后触发
    ws.onmessage = function (evt) {
        // 获取服务端推送过来的消息
        var dataStr = evt.data;
        // 将dataStr转换为json对象
        var res = JSON.parse(dataStr);
        // 判断是否是系统消息
        if (res.isSystem) {
            // 系统消息
            var names = res.message
            // 1.好友列表展示
            var userListStr = "";
            // 2.系统广播的展示
            var broadcastListStr = "";
            for (var name of names) {
                if (name === username) {
                    continue
                }
                userListStr += name
                broadcastListStr += name
            }
            // 渲染好友列表和系统广播
            // ...
        } else {
            // 不是系统消息,即来自用户的消息
            // 将服务端推送的消息进行展示
            var str = res.message

            // 将收到的消息追加到聊天框,需要判断当前聊天的人是否是给你发送消息的人
            if (toName == res.fromName) {
                $("#msgs").append(str)
            }

            // 存储接收到的消息
            var chatData = sessionStorage.getItem(res.fromName);
            if (!chatData) {
                str = chatData + str
            }

            sessionStorage.setItem(res.fromName, str)

        }
    }

    ws.onclose = function () {

    }

    // 发送信息
    $("#submit").click(function () {
        // 获取输入内容
        var data = $("#context_text").val();
        // 清空输入区的内容
        $("#context_text").val('')
        // 拼接消息
        var json = {
            toName,
            message: data
        }

        // 将发送的消息展示在聊天框
        var str = ''
        $("#msgs").append(str)

        // 存储发送的消息
        var chatData = sessionStorage.getItem(toName);
        if (!chatData) {
            str = chatData + str
        }

        sessionStorage.setItem(toName, str)

        // 发送数据给服务器
        ws.send(JSON.stringify(json))

    })
</script>
</body>
</html>