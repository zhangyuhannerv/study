<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    #map-container {
      height: 900px;
    }

    .custom-content-marker {
      position: relative;
      width: 25px;
      height: 34px;
    }

    .custom-content-marker img {
      width: 100%;
      height: 100%;
    }
  </style>
</head>

<body>
  <div id="map-container"></div>

  <script src="../lib/jQuery/jquery-3.1.1.min.js"></script>
  <script type="text/javascript"
    src="https://webapi.amap.com/maps?v=2.0&key=a45b8935299e65fa1631dbef2d05d6cf&plugin=AMap.LineSearch"></script>
  <script>
    // 初始化地图
    var map = new window.AMap.Map('map-container', {
      viewMode: "3D", //是否为3D地图模式
      zoom: 10, //初始化地图级别
      center: [113.26, 23.13], //初始化地图中心点位置
    })

    $.ajax({
      url: './GZ11pathData.txt', // 文件相对地址（相对于使用这个js脚本的html文件,非常重要，仔细理解这句话）
      success: function (data) {
        let pathArr = data.split('\r\n')
        let path = []
        pathArr.forEach((e, i) => {
          if (i !== 0 && e) {
            path.push(e.split(','))
          }
        });

        drawbusLine(path)


        // 车动起来
        let pathIndex = 0
        let carMarker = new AMap.Marker({
          position: path[pathIndex],
          icon: 'https://a.amap.com/jsapi_demos/static/demo-center/icons/poi-marker-default.png',
          anchor: 'bottom-center',
        });

        map.add(carMarker)

        setInterval(function () {
          pathIndex++
          if (pathIndex == path.length) {
            pathIndex = 0
          }
          carMarker.setPosition(path[pathIndex])
        }, 100)

      },

    })

    /* 绘制路线 */
    function drawbusLine(BusArr) {
      let busPolyline = new window.AMap.Polyline({
        map: map,
        path: BusArr,
        strokeColor: 'red', // 线颜色
        strokeOpacity: 0.8, // 线透明度
        isOutline: true,
        outlineColor: 'white',
        strokeWeight: 10 // 线宽
      })
    }

    const markerContent = '' +
      '<div class="custom-content-marker">' +
      '   <img src="//a.amap.com/jsapi_demos/static/demo-center/icons/dir-via-marker.png">' +
      '</div>';
    $.ajax({
      url: './GZ11StationData.txt', // 文件相对地址（相对于使用这个js脚本的html文件,非常重要，仔细理解这句话）
      success: function (data) {
        let pathArr = data.split('\r\n')
        let path = []
        pathArr.forEach((e, i) => {
          if (i !== 0 && e) {
            let arr = e.split(',')
            path.push([arr[1], arr[2]])
          }
        });
        drawPoint(path, markerContent)
      },

    })

    function drawPoint(positionArr, markerContent) {
      positionArr.forEach(e => {
        let marker = new AMap.Marker({
          position: e,
          content: markerContent, // 将 html 传给 content
          offset: new AMap.Pixel(-13, -30) // 以 icon 的 [center bottom] 为原点
        });
        map.add(marker)
      });
    }



  </script>
</body>

</html>